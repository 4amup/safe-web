# safe-web
## 后端需求实现TODO list
* [x] 引入腾讯地图，使用腾讯地图api的markers将问题点标记
* [x] 腾讯地图不显示跨，准备更改至
~~[天地图](http://map.tianditu.com/)，或者为~~
[高德地图](http://ditu.amap.com/)
* [x] 问题点提示窗口用map的api解决
* ~~提交问题后实时刷新前端页面，采用ajax异步提交~~，目前已经用res.redirect解决
* [x] 模板渲染时，需要传参数进去
* [x] 登录管理
* [ ] 权限管理
* [x]地图地理位置按照区域划分，加上电子围栏，
~~[腾讯地图api](http://bbs.map.qq.com/thread-8859-1-1.html)，[百度地图电子围栏开发](http://www.cnblogs.com/dongh/p/6589503.html)~~
使用高德地图的多边形覆盖物完美解决，相比于腾讯更加精确范围。
* [x] setCompany页面，为特定权限用户添加功能-自己划定自己管理的区域，即一个[多边形覆盖物](http://lbs.qq.com/javascript_v2/doc/polygon.html)（电子围栏）；
* ~~setDepartment页面，划线将自己单位存好，确定后上传数据至后端~~
* ~~setArea页面，划线将自己单位的小区域存好，确定后上传数据至后端~~
* [ ] 哪块隐患大，问题多，定位相关区域后，提示普通用户，使用热力图api
* [ ] 添加隐患评论功能
## 使用场景分析
* 首页展示页面
* 问题和整改展示页面。若未整改，显示表单提交页面，已整改直接展示整改图。
* 个人中心页面
* 登录页面
* 注册页面
## 权限系统分析
* [ ] 普通用户-实名认证后可发布隐患问题，但需要审核，不可点开细节图看，只能看分布区域，是否已经整改
* [ ] 普通发布用户和整改者，可分别获得~~红包~~积分奖励
* [ ] 普通用户-实名认证表单，姓名，单位，上传工作证，共3项
* [ ] 安全员用户-由超级管理员进行后台认证，权限可划定自己单位管理范围
* [ ] 安全部门管理者（超级管理员）-进行后台普通员工实名认证、公司管理者认证、安全员认证，划定公司的范围，添加单位名称，，人工绑定部门管理员，审核普通用户发布的问题
* [ ] 部门管理员可以直达问题具体页面，查看措施，评论问题，修改本单位管理范围，查看本单位隐患整改率、和别的单位对比。
## 手机端（client）分析
* [ ] 暂时方案选定小程序，共用api获取数据，后续开发一个[PWA应用](https://segmentfault.com/a/1190000008880637)；
* [ ] 渐进式开发，如果可以，直接先开发安卓，毕竟使用人数众多
* [ ] 问题上传页面完全仿发朋友圈的模式
## 前端分析
* [x] 读取上传图片的[exif](http://code.ciaoca.com/javascript/exif-js/)信息，将gps数据提取，自动定位区域
* ~~层级分为单位（部门）、部位（或区域）二级select~~
* 层级直接做成点，根据定位自动计算距离最近的单位，点可以自定义，类似滴滴打车，单位可以做成区域
* ~~将问题提交做成弹出层~~
* [ ] 智能识别问题是人还是物，自动选择，普通用户只开放物的权限
## 数据库设计
* [x] 图片的属性信息是原始拍摄时间，上传时的时间是写入数据库的时间，还有修改时间，这些信息，使用时都要建立相关的内容
* [x] 部门、点位、时间、描述（语音或文字）、图片（cos链接）、经纬度gps（后端存储，前端不明示）、人或者物的状态
* [ ] 每次管理员更新分厂的范围之后，增加地图版本的记录。比如2015年几月几日，范围更新，以前是叫啥分厂，现在叫啥分厂。避免更新地图范围后，数据出现混淆。
## 项目展望
1. 将来是否可以做成可扩展的，提供sass服务的，按次收费的，企业账户下n多账户，子域名，企业可以在里面充值奖励提出问题的员工；
2. 前期的奖励金可以是虚拟币，后续可以改成实际的钱；
3. 项目运行后，使用vue.js或react.js等前端框架进行重构；
4. 开发专业的安卓或IOS客户端；
5. 增加室内地图模式，考虑保密，权限系统控制展示，仅仅展示给安全员以上人员，或者普通用户提交时，仅仅显示部分室内地图，且不可下载